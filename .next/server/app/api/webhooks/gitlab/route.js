(()=>{var e={};e.id=646,e.ids=[646],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},45519:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>w,routeModule:()=>d,serverHooks:()=>h,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>c});var s={};r.r(s),r.d(s,{POST:()=>p});var a=r(42706),i=r(28203),n=r(45994),o=r(39187);let u=new(r(96330)).PrismaClient;async function p(e){try{let t=await e.json(),r=e.headers.get("x-gitlab-token");if(process.env.GITLAB_WEBHOOK_TOKEN&&r!==process.env.GITLAB_WEBHOOK_TOKEN)return o.NextResponse.json({error:"Unauthorized"},{status:401});let{object_kind:s,object_attributes:a,project:i}=t;if("pipeline"===s){let e=a.id.toString(),t=a.status,r=a.stage,s=await u.project.findFirst({where:{gitlabId:i.id.toString()}});s&&await u.pipeline.upsert({where:{gitlabId:e},update:{status:t.toUpperCase(),stage:r,startedAt:a.started_at?new Date(a.started_at):null,finishedAt:a.finished_at?new Date(a.finished_at):null,duration:a.duration,updatedAt:new Date},create:{gitlabId:e,status:t.toUpperCase(),stage:r,startedAt:a.started_at?new Date(a.started_at):null,finishedAt:a.finished_at?new Date(a.finished_at):null,duration:a.duration,projectId:s.id}})}return o.NextResponse.json({success:!0})}catch(e){return console.error("Webhook error:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/webhooks/gitlab/route",pathname:"/api/webhooks/gitlab",filename:"route",bundlePath:"app/api/webhooks/gitlab/route"},resolvedPagePath:"/workspace/app/api/webhooks/gitlab/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:l,workUnitAsyncStorage:c,serverHooks:h}=d;function w(){return(0,n.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:c})}},96487:()=>{},78335:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[989,452],()=>r(45519));module.exports=s})();